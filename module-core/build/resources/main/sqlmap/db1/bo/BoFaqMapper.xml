<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fw.core.mapper.db1.bo.BoFaqMapper">
    <select id="selectFaqList" parameterType="BoFaqDTO" resultType="BoFaqDTO">
        SELECT ROW_NUMBER() OVER (ORDER BY FAQ_ID DESC) AS rowNum
             , FAQ_ID
             , date_format(CREATE_DT, '%Y-%m-%d %H:%i') as createDt
             , CATEGORY
             , CASE WHEN CATEGORY = 'ESTIMATE' THEN '견적관련'
                    WHEN CATEGORY = 'PAYMENT' THEN '결제관련'
                    WHEN CATEGORY = 'SIGNUP' THEN '회원가입' END AS categoryNm
             , title
             , CREATE_ID
             , USE_YN
        FROM t_faq
        <where>
            <if test="searchStart != null and searchStart != ''">
                AND date_format(CREATE_DT, '%Y-%m-%d') <![CDATA[>=]]> #{searchStart}
            </if>
            <if test="searchEnd != null and searchEnd != ''">
                AND date_format(CREATE_DT, '%Y-%m-%d') <![CDATA[<=]]> #{searchEnd}
            </if>
            <if test="searchType != null and searchType != ''">
                AND CATEGORY = #{searchType}
            </if>
            AND DEL_YN = 'N'
        </where>
        ORDER BY FAQ_ID DESC
        <include refid="common.paging" />
    </select>

    <select id="selectFaqListCnt" parameterType="BoFaqDTO" resultType="int">
        SELECT COUNT(*)
        FROM t_faq
        <where>
            <if test="searchStart != null and searchStart != ''">
                AND date_format(CREATE_DT, '%Y-%m-%d') <![CDATA[>=]]> #{searchStart}
            </if>
            <if test="searchEnd != null and searchEnd != ''">
                AND date_format(CREATE_DT, '%Y-%m-%d') <![CDATA[<=]]> #{searchEnd}
            </if>
            <if test="searchType != null and searchType != ''">
                AND CATEGORY = #{searchType}
            </if>
            AND DEL_YN = 'N'
        </where>
    </select>

   <!-- <select id="selectCategoryList" resultType="BoContentDTO">
        SELECT
            CATEGORY_ID,
            CATEGORY_NAME
        FROM t_category
        WHERE del_yn = 'N'
        ORDER BY CATEGORY_ID
    </select>-->

    <insert id="insertFaq" parameterType="BoFaqDTO">
        INSERT INTO t_faq
        (
            CATEGORY,
            CONTENT,
            TITLE,
            USE_YN,
            DEL_YN,
            CREATE_ID,
            CREATE_DT
        ) VALUES
        (
            #{category},
            #{content},
            #{title},
            'Y',
            'N',
            '1',
            now()
        )
    </insert>

    <select id="selectFaqDetail" parameterType="String" resultType="BoFaqDTO">
        SELECT date_format(CREATE_DT, '%Y-%m-%d %H:%i') as createDt
             , CATEGORY
             , CASE WHEN CATEGORY = 'ESTIMATE' THEN '견적관련'
                    WHEN CATEGORY = 'PAYMENT' THEN '결제관련'
                    WHEN CATEGORY = 'SIGNUP' THEN '회원가입' END AS categoryNm
             , USE_YN
             , TITLE
             , CONTENT
        FROM t_faq
        WHERE FAQ_ID = #{faqId}
    </select>

    <update id="updateFaq" parameterType="BoFaqDTO">
        UPDATE t_faq
        SET
            CATEGORY = #{category},
            USE_YN = #{useYn},
            TITLE = #{title},
            CONTENT = #{content},
            UPDATE_DT = now(),
            UPDATE_ID = '1'
        WHERE
            faqId = #{faqId}
    </update>
</mapper>